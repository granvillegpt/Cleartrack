<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apply to Become a ClearTrack Practitioner</title>
  <link rel="icon" type="image/png" href="assets/images/icon%20logo.png">
  
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="https://firestore.googleapis.com">
  <script defer src="/js/pwa-loader.js"></script>
  
  <link rel="stylesheet" href="/css/ct-theme.css">
  
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fa;
      color: #1f2933;
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }

    /* Style 6: Compact Dropdown (Minimal) - Clean Implementation */
    header {
      background: #0b7285;
      color: #fff;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      width: 100%;
      max-width: 100vw;
      box-sizing: border-box;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }

    .brand img {
      height: 35px;
      max-width: 100%;
      width: auto;
      object-fit: contain;
    }

    /* Style 6: Hamburger menu button */
    .menu-toggle-style6 {
      background: transparent;
      border: none;
      color: #e0fbff;
      cursor: pointer;
      font-size: 1.3rem;
      display: none;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      transition: transform 0.3s ease;
    }

    .menu-toggle-style6:hover {
      transform: scale(1.1);
    }

    .menu-toggle-style6.active {
      transform: rotate(90deg);
    }

    /* Style 6: Navigation - Desktop (visible by default) */
    nav.nav-style6 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    nav.nav-style6 a {
      color: #e0fbff;
      font-size: 0.95rem;
      text-decoration: none;
      white-space: nowrap;
      padding: 0.25rem 0.5rem;
    }

    nav.nav-style6 a:hover {
      text-decoration: underline;
    }

    /* Desktop: Hide hamburger, show nav */
    @media (min-width: 769px) {
      .menu-toggle-style6 {
        display: none;
      }

      nav.nav-style6 {
        display: flex;
        position: static;
        background: transparent;
        border-radius: 0;
        box-shadow: none;
        min-width: auto;
        max-height: none;
        opacity: 1;
        flex-direction: row;
        gap: 0.75rem;
        overflow: visible;
        z-index: auto;
      }

      nav.nav-style6 a {
        color: #e0fbff;
        font-size: 0.95rem;
        text-decoration: none;
        white-space: nowrap;
        padding: 0.25rem 0.5rem;
        display: inline-block;
        width: auto;
      }

      nav.nav-style6 a:hover {
        text-decoration: underline;
        background: transparent;
        padding-left: 0.5rem;
      }
    }

    /* Mobile: Show hamburger, nav as dropdown */
    @media (max-width: 768px) {
      header {
        padding: 1rem;
      }

      .brand img {
        height: 30px;
      }

      .menu-toggle-style6 {
        display: flex;
      }

      /* Style 6: Nav as dropdown - exactly like demo */
      nav.nav-style6 {
        position: absolute;
        top: calc(100% + 0.5rem);
        right: 1.5rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        min-width: 220px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, opacity 0.3s ease;
        opacity: 0;
        z-index: 1000;
        display: block;
        flex-direction: initial;
        align-items: initial;
        gap: 0;
        flex-wrap: initial;
      }

      nav.nav-style6.active {
        max-height: 400px;
        opacity: 1;
      }

      nav.nav-style6 a {
        color: #1f2933;
        text-decoration: none;
        padding: 0.75rem 1.25rem;
        display: block;
        font-size: 0.95rem;
        transition: all 0.2s;
        border: none;
        margin: 0;
        width: 100%;
        box-sizing: border-box;
      }

      nav.nav-style6 a:hover {
        background: #f5f7fa;
        color: #0b7285;
        padding-left: 1.5rem;
      }

      nav.nav-style6 a:first-child {
        border-radius: 12px 12px 0 0;
      }

      nav.nav-style6 a:last-child {
        border-radius: 0 0 12px 12px;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 0.75rem;
      }

      .brand img {
        height: 28px;
      }

      nav.nav-style6 {
        right: 0.75rem;
        min-width: 200px;
      }
    }

    main {
      max-width: 800px;
      margin: 0 auto;
      padding: clamp(1.5rem, 4vw, 2rem) clamp(1rem, 3vw, 1.5rem) clamp(2rem, 5vw, 3rem);
      width: 100%;
      box-sizing: border-box;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
      padding: clamp(1.25rem, 4vw, 2rem);
      margin-bottom: 2rem;
    }

    h1 {
      color: #0b7285;
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-size: clamp(1.5rem, 5vw, 2rem);
      line-height: 1.2;
      font-weight: 700;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: clamp(0.95rem, 2.5vw, 1.05rem);
      line-height: 1.5;
    }

    .form-group {
      margin-bottom: clamp(1.25rem, 3vw, 1.5rem);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: clamp(0.75rem, 2vw, 1rem);
    }

    @media (max-width: 640px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #334e68;
      font-size: clamp(0.85rem, 2vw, 0.9rem);
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="tel"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      box-sizing: border-box;
      padding: clamp(0.625rem, 2vw, 0.75rem);
      border: 1px solid #cbd2e1;
      border-radius: 8px;
      font-size: clamp(0.9rem, 2.5vw, 0.95rem);
      font-family: inherit;
      transition: border-color 0.2s ease;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #0b7285;
      box-shadow: 0 0 0 3px rgba(11, 114, 133, 0.1);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    @media (max-width: 640px) {
      .checkbox-group {
        grid-template-columns: 1fr;
      }
    }

    .checkbox-label {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 0.625rem 0.875rem;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      background: #f9fafb;
      gap: 0.625rem;
      width: 100%;
    }

    .checkbox-label:hover {
      background: #f3f4f6;
      border-color: #d1d5db;
    }

    .checkbox-label input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #0b7285;
      flex-shrink: 0;
      margin: 0;
      display: inline-block;
      vertical-align: middle;
    }

    .checkbox-label:has(input:checked) {
      background: #ffffff;
      border-color: #0b7285;
    }

    .checkbox-label span {
      font-size: 0.9rem;
      color: #374151;
      user-select: none;
      line-height: 1.4;
      display: inline-block;
      vertical-align: middle;
    }

    button[type="submit"] {
      background: #0b7285;
      color: #ffffff;
      border: none;
      padding: clamp(0.75rem, 2vw, 0.875rem) clamp(1.5rem, 4vw, 2rem);
      border-radius: 8px;
      font-size: clamp(0.95rem, 2.5vw, 1rem);
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }

    button[type="submit"]:active {
      transform: scale(0.98);
    }

    button[type="submit"]:hover {
      background: #095a69;
    }

    button[type="submit"]:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }

    .alert {
      padding: clamp(0.75rem, 2vw, 1rem);
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
      font-size: clamp(0.875rem, 2vw, 0.95rem);
    }

    .alert.show {
      display: block;
    }

    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #6ee7b7;
    }

    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }

    .note {
      font-size: clamp(0.8rem, 2vw, 0.85rem);
      color: #6b7280;
      margin-top: 0.5rem;
      font-style: italic;
      line-height: 1.4;
    }

  </style>
</head>
<body>
  <header>
    <div class="brand"><img src="assets/images/full%20logo%20CT.png" alt="ClearTrack Logo" style="height:40px; filter: brightness(0) invert(1);"></div>
    <button class="menu-toggle-style6" aria-label="Toggle menu" id="menuToggle">â˜°</button>
    <nav class="nav-style6" id="mainNav">
      <a href="#features">Features</a>
      <a href="#who-for">Who it's for</a>
      <a href="/practitioner-application.html">For Practitioners</a>
      <a href="/contact.html">Contact</a>
      <a href="/login.html">Login</a>
    </nav>
  </header>

  <main>
    <div class="card">
      <h1>Apply to Become a ClearTrack Practitioner</h1>
      <p class="subtitle">
        Join ClearTrack as a tax practitioner to help clients manage their SARS-compliant travel logbooks and tax documents.
      </p>

      <div id="feedback" class="alert"></div>

      <form id="applicationForm">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input type="text" id="firstName" name="firstName" required>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input type="text" id="lastName" name="lastName" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">Email Address *</label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input type="tel" id="phone" name="phone" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="password">Temporary Password *</label>
            <div style="position: relative;">
              <input type="password" id="password" name="password" required minlength="6" style="padding-right: 2.5rem;">
              <button type="button" id="togglePassword" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0.25rem; color: #6b7280; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;" aria-label="Toggle password visibility">
                <svg id="passwordIcon" width="20" height="20" viewBox="0 0 90 90" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M 45 73.264 c -14.869 0 -29.775 -8.864 -44.307 -26.346 c -0.924 -1.112 -0.924 -2.724 0 -3.836 C 15.225 25.601 30.131 16.737 45 16.737 c 14.868 0 29.775 8.864 44.307 26.345 c 0.925 1.112 0.925 2.724 0 3.836 C 74.775 64.399 59.868 73.264 45 73.264 z M 6.934 45 C 19.73 59.776 32.528 67.264 45 67.264 c 12.473 0 25.27 -7.487 38.066 -22.264 C 70.27 30.224 57.473 22.737 45 22.737 C 32.528 22.737 19.73 30.224 6.934 45 z"/>
                  <path d="M 45 62 c -9.374 0 -17 -7.626 -17 -17 s 7.626 -17 17 -17 s 17 7.626 17 17 S 54.374 62 45 62 z M 45 34 c -6.065 0 -11 4.935 -11 11 s 4.935 11 11 11 s 11 -4.935 11 -11 S 51.065 34 45 34 z"/>
                </svg>
              </button>
            </div>
            <small style="display: block; margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">
              You will receive a password reset link after approval. Your username will be your email address.
            </small>
          </div>
          <div class="form-group">
            <!-- Empty column to maintain layout -->
          </div>
        </div>

        <div class="form-group">
          <label for="practiceName">Practice Name *</label>
          <input type="text" id="practiceName" name="practiceName" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="practiceNumber">Practice Number</label>
            <input type="text" id="practiceNumber" name="practiceNumber">
            <p class="note">Your professional practice registration number (if applicable)</p>
          </div>
          <div class="form-group">
            <label for="sarsNumber">SARS Practitioner Number</label>
            <input type="text" id="sarsNumber" name="sarsNumber">
            <p class="note">Your SARS practitioner registration number</p>
          </div>
        </div>

        <div class="form-group">
          <label for="yearsExperience">Years of Experience *</label>
          <input type="number" id="yearsExperience" name="yearsExperience" min="0" required>
        </div>

        <div class="form-group">
          <label for="qualifications">Qualifications *</label>
          <textarea id="qualifications" name="qualifications" required placeholder="List your professional qualifications, certifications, and relevant education"></textarea>
        </div>

        <div class="form-group">
          <label>Specializations *</label>
          <p class="note">Select all that apply to your practice</p>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Individual Tax Returns">
              <span>Individual Tax Returns</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Small Business Tax">
              <span>Small Business Tax</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="SARS Compliance">
              <span>SARS Compliance</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Corporate Tax">
              <span>Corporate Tax</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Tax Planning">
              <span>Tax Planning</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="VAT">
              <span>VAT</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Payroll Tax">
              <span>Payroll Tax</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="specializations" value="Estate Planning">
              <span>Estate Planning</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="bio">Professional Bio</label>
          <textarea id="bio" name="bio" placeholder="Tell us about your practice and experience (optional)"></textarea>
        </div>

        <div class="form-group">
          <label for="message">Additional Information</label>
          <textarea id="message" name="message" placeholder="Any additional information you'd like to share (optional)"></textarea>
        </div>

        <button type="submit" id="submitBtn">Submit Application</button>
      </form>
    </div>
  </main>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-functions-compat.js"></script>

  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('applicationForm');
      const submitBtn = document.getElementById('submitBtn');
      const feedback = document.getElementById('feedback');

      function showFeedback(message, type) {
        feedback.textContent = message;
        feedback.className = `alert alert-${type} show`;
        setTimeout(() => {
          feedback.classList.remove('show');
        }, 5000);
      }

      // Password visibility toggle
      const togglePassword = document.getElementById('togglePassword');
      const passwordInput = document.getElementById('password');
      const passwordIcon = document.getElementById('passwordIcon');
      
      // Eye icon SVG (show password)
      const eyeIcon = `<svg id="passwordIcon" width="20" height="20" viewBox="0 0 90 90" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M 45 73.264 c -14.869 0 -29.775 -8.864 -44.307 -26.346 c -0.924 -1.112 -0.924 -2.724 0 -3.836 C 15.225 25.601 30.131 16.737 45 16.737 c 14.868 0 29.775 8.864 44.307 26.345 c 0.925 1.112 0.925 2.724 0 3.836 C 74.775 64.399 59.868 73.264 45 73.264 z M 6.934 45 C 19.73 59.776 32.528 67.264 45 67.264 c 12.473 0 25.27 -7.487 38.066 -22.264 C 70.27 30.224 57.473 22.737 45 22.737 C 32.528 22.737 19.73 30.224 6.934 45 z"/>
        <path d="M 45 62 c -9.374 0 -17 -7.626 -17 -17 s 7.626 -17 17 -17 s 17 7.626 17 17 S 54.374 62 45 62 z M 45 34 c -6.065 0 -11 4.935 -11 11 s 4.935 11 11 11 s 11 -4.935 11 -11 S 51.065 34 45 34 z"/>
      </svg>`;
      
      // Eye-slash icon SVG (hide password)
      const eyeSlashIcon = `<svg id="passwordIcon" width="20" height="20" viewBox="0 0 90 90" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M 13.148 79.853 c -0.768 0 -1.536 -0.293 -2.121 -0.879 c -1.172 -1.171 -1.172 -3.071 0 -4.242 l 63.705 -63.705 c 1.172 -1.172 3.07 -1.172 4.242 0 c 1.172 1.171 1.172 3.071 0 4.242 L 15.269 78.974 C 14.684 79.56 13.916 79.853 13.148 79.853 z"/>
        <path d="M 25.296 67.703 c -0.504 0 -1.012 -0.127 -1.474 -0.388 C 16.105 62.961 8.323 56.098 0.693 46.918 c -0.924 -1.112 -0.924 -2.724 0 -3.835 c 21.533 -25.904 43.565 -32.767 65.485 -20.399 c 0.816 0.461 1.371 1.277 1.498 2.207 s -0.188 1.864 -0.852 2.527 L 27.418 66.824 C 26.841 67.402 26.073 67.703 25.296 67.703 z M 6.933 45 c 5.972 6.896 11.974 12.242 17.891 15.934 l 34.842 -34.842 C 42.131 18.098 24.824 24.311 6.933 45 z"/>
        <path d="M 34.394 58.606 c -0.795 0 -1.558 -0.315 -2.121 -0.878 C 28.873 54.329 27 49.809 27 45 c 0 -9.925 8.075 -18 18 -18 c 4.749 0 9.23 1.833 12.617 5.163 c 0.569 0.56 0.893 1.322 0.897 2.12 s -0.308 1.565 -0.869 2.132 L 36.524 57.719 c -0.562 0.566 -1.326 0.886 -2.124 0.888 C 34.398 58.606 34.396 58.606 34.394 58.606 z M 45 33 c -6.617 0 -12 5.383 -12 12 c 0 2.175 0.574 4.261 1.651 6.085 L 50.995 34.6 C 49.19 33.556 47.136 33 45 33 z"/>
        <path d="M 44.973 73.26 c -3.552 0 -7.104 -0.501 -10.657 -1.505 c -1.594 -0.45 -2.521 -2.108 -2.071 -3.703 c 0.45 -1.594 2.105 -2.524 3.703 -2.07 C 51.38 70.341 67.226 63.287 83.066 45 c -3.977 -4.592 -7.98 -8.514 -11.925 -11.68 c -1.292 -1.037 -1.499 -2.925 -0.462 -4.218 c 1.038 -1.292 2.927 -1.499 4.218 -0.462 c 4.796 3.849 9.644 8.708 14.409 14.442 c 0.925 1.111 0.925 2.724 0 3.835 C 74.743 64.438 59.874 73.26 44.973 73.26 z"/>
        <path d="M 45 63 c -0.386 0 -0.77 -0.013 -1.149 -0.036 c -1.654 -0.101 -2.913 -1.523 -2.812 -3.178 c 0.102 -1.652 1.527 -2.909 3.178 -2.811 C 44.476 56.991 44.737 57 45 57 c 6.617 0 12 -5.383 12 -12 c 0 -0.27 -0.009 -0.538 -0.026 -0.803 c -0.107 -1.653 1.146 -3.081 2.799 -3.188 c 1.665 -0.103 3.082 1.146 3.189 2.799 C 62.987 44.202 63 44.599 63 45 C 63 54.925 54.925 63 45 63 z"/>
      </svg>`;
      
      if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
          const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordInput.setAttribute('type', type);
          // Get fresh reference to icon element each time
          const passwordIcon = document.getElementById('passwordIcon');
          if (passwordIcon) {
            passwordIcon.outerHTML = type === 'password' ? eyeIcon : eyeSlashIcon;
          }
        });
      }

      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validate specializations
        const specializations = Array.from(document.querySelectorAll('input[name="specializations"]:checked'))
          .map(cb => cb.value);
        
        if (specializations.length === 0) {
          showFeedback('Please select at least one specialization.', 'error');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        // Validate required fields before submission
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const phone = document.getElementById('phone').value.trim();
        const practiceName = document.getElementById('practiceName').value.trim();
        const yearsExperienceValue = document.getElementById('yearsExperience').value.trim();
        const qualifications = document.getElementById('qualifications').value.trim();

        // Validate required fields
        if (!firstName || !lastName || !email || !password || !phone || !practiceName || !qualifications) {
          showFeedback('Please fill in all required fields (marked with *).', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
          return;
        }

        // Validate password length
        if (password.length < 6) {
          showFeedback('Password must be at least 6 characters long.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
          return;
        }

        // Validate years of experience
        if (!yearsExperienceValue) {
          showFeedback('Please enter years of experience.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
          return;
        }

        const yearsExperience = parseInt(yearsExperienceValue);
        if (isNaN(yearsExperience) || yearsExperience < 0) {
          showFeedback('Years of experience must be a valid number (0 or greater).', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
          return;
        }

        const formData = {
          firstName,
          lastName,
          email,
          phone,
          practiceName,
          practiceNumber: document.getElementById('practiceNumber').value.trim() || null,
          sarsNumber: document.getElementById('sarsNumber').value.trim() || null,
          yearsExperience,
          qualifications,
          specializations: specializations,
          bio: document.getElementById('bio').value.trim() || null,
          message: document.getElementById('message').value.trim() || null
        };

        try {
          // Check Firebase initialization
          if (!window.firebaseDb || !window.firebaseAuth) {
            throw new Error('Firebase not initialized. Please ensure firebase-init.js is loaded.');
          }

          // Step 1: Create Firebase Auth user with email and password
          console.log('Creating Firebase Auth user...');
          let userCredential;
          try {
            userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(email, password);
            console.log('Firebase Auth user created successfully:', userCredential.user.uid);
          } catch (authError) {
            // If user already exists, that's okay - they might have registered before
            if (authError.code === 'auth/email-already-in-use') {
              console.log('User already exists in Firebase Auth, continuing with application submission...');
            } else {
              throw new Error('Failed to create account: ' + (authError.message || authError.code));
            }
          }

          // Step 2: Save application to Firestore
          console.log('Saving application to Firestore...');
          const applicationRef = window.firebaseDb.collection('practitionerApplications').doc();
          const applicationData = {
            ...formData,
            applicationId: applicationRef.id,
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };

          await applicationRef.set(applicationData);
          console.log('Application saved successfully to Firestore. Application ID:', applicationRef.id);

          // Step 3: Sign out the user (they shouldn't be logged in yet)
          if (userCredential && userCredential.user) {
            await window.firebaseAuth.signOut();
            console.log('Signed out user after account creation');
          }

          showFeedback('Application submitted successfully! We will review your application and contact you soon.', 'success');
          form.reset();

          // Redirect after a delay
          setTimeout(() => {
            window.location.href = '/index.html';
          }, 3000);

        } catch (error) {
          console.error('Error submitting application:', error);
          console.error('Error code:', error.code);
          console.error('Error message:', error.message);
          console.error('Error details:', error.details);
          
          // Extract error message from Firebase Functions error
          let errorMessage = 'Failed to submit application. Please try again or contact us directly.';
          
          if (error.code === 'functions/not-found') {
            errorMessage = 'Cloud Function not found. Trying to save directly to Firestore...';
            // Fallback: Try to save directly to Firestore
            try {
              if (!window.firebaseDb) {
                throw new Error('Firebase not initialized. Please ensure firebase-init.js is loaded.');
              }
              
              const applicationRef = window.firebaseDb.collection('practitionerApplications').doc();
              const applicationData = {
                ...formData,
                applicationId: applicationRef.id,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
              };
              
              await applicationRef.set(applicationData);
              
              showFeedback('Application submitted successfully! (Saved directly to Firestore)', 'success');
              form.reset();
              
              setTimeout(() => {
                window.location.href = '/index.html';
              }, 3000);
              return;
            } catch (fallbackError) {
              console.error('Fallback save also failed:', fallbackError);
              errorMessage = 'Failed to submit application. Please check your connection and try again.';
            }
          } else if (error.code === 'functions/invalid-argument') {
            errorMessage = error.message || error.details || 'Please check that all required fields are filled correctly.';
          } else if (error.code === 'functions/internal') {
            // Try to extract the actual error message from the internal error
            const actualMessage = error.message || error.details || 'An internal error occurred.';
            errorMessage = actualMessage;
            
            // If Cloud Function fails, try fallback to direct Firestore save
            console.log('Cloud Function failed, attempting direct Firestore save...');
            try {
              if (window.firebaseDb) {
                const applicationRef = window.firebaseDb.collection('practitionerApplications').doc();
                const applicationData = {
                  ...formData,
                  applicationId: applicationRef.id,
                  status: 'pending',
                  createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                  updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await applicationRef.set(applicationData);
                
                showFeedback('Application submitted successfully! (Saved directly to Firestore - Cloud Function unavailable)', 'success');
                form.reset();
                
                setTimeout(() => {
                  window.location.href = '/index.html';
                }, 3000);
                return;
              }
            } catch (fallbackError) {
              console.error('Fallback save failed:', fallbackError);
              errorMessage = `Cloud Function error: ${actualMessage}. Direct save also failed.`;
            }
          } else if (error.message) {
            errorMessage = error.message;
          } else if (error.details) {
            errorMessage = error.details;
          }
          
          showFeedback(errorMessage, 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Application';
        }
      });
    });

    // Style 6: Compact Dropdown Menu Toggle - Clean Implementation
    (function() {
      const menuToggle = document.getElementById("menuToggle");
      const mainNav = document.getElementById("mainNav");

      if (menuToggle && mainNav) {
        function toggleMenu() {
          mainNav.classList.toggle('active');
          menuToggle.classList.toggle('active');
        }

        menuToggle.addEventListener("click", function(e) {
          e.stopPropagation();
          toggleMenu();
        });

        // Close menu when clicking on a link
        const navLinks = mainNav.querySelectorAll("a");
        navLinks.forEach(function(link) {
          link.addEventListener("click", function() {
            mainNav.classList.remove('active');
            menuToggle.classList.remove('active');
          });
        });

        // Close menu when clicking outside (Style 6 dropdown)
        document.addEventListener('click', function(event) {
          const header = document.querySelector("header");
          if (mainNav.classList.contains('active')) {
            if (header && !header.contains(event.target)) {
              mainNav.classList.remove('active');
              menuToggle.classList.remove('active');
            }
          }
        });
      }
    })();
  </script>
</body>
</html>


